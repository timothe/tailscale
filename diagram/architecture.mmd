flowchart LR
 subgraph Tailnet["Tailnet Control Plane"]
  end
 subgraph GCP["Default VPC / default subnetwork (region)"]
    direction LR
        TSRouter["ts-router (GCP VM)<br>Tailscale SSH + Subnet Router<br>NIC: 10.x.y.z"]
        SVC["service-host (GCP VM)<br>HTTP :8080 on internal IP"]
  end
 subgraph HomeLAN["Home LAN 192.168.4.0/24"]
        IoT1["Router 192.168.4.1"]
        IoT2["Fire TV 192.168.4.79"]
  end
    Laptop["My Laptop (Tailscale client)"] --- Tailnet
    TSRouter --- Tailnet
    Nas["Nasputin (optional)<br>Home subnet router (DSM cannot accept routes)"] --- Tailnet & HomeLAN
    Laptop == Tailscale tunnel ==> TSRouter
    TSRouter == "VPC routing (10.x.y.0/20)" ==> SVC
    Tailnet --- Approved["Subnet route 10.x.y.0/20<br>(approved in Tailnet)"]
    style IoT1 stroke:#757575,color:#757575
    style IoT2 stroke:#757575,color:#757575
    style Nas stroke:#757575,color:#757575
    style HomeLAN stroke:#757575,color:#757575
